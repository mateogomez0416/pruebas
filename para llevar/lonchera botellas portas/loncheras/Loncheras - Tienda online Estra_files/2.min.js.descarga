(window.webpackJsonpvtex_reviews_and_ratings_2_12_8=window.webpackJsonpvtex_reviews_and_ratings_2_12_8||[]).push([[2],{51:function(e,a,i){"use strict";i.r(a),i.d(a,"ReviewForm",(function(){return V}));var n=i(54),t=i.n(n),r=i(68),s=i(2),o=i(0),l=i.n(o),d=i(12),c=i.n(d),m=i(7),u=i(1),v=i(9),f=i.n(v),g=i(49),b=i.n(g),p=i(23),h=i.n(p),E=i(8),k=i.n(E),S=i(50),w=i.n(S),N=i(69),T=i.n(N),I=i(55),y=i.n(I),O=i(18),_=i(6),M=i.n(_),j=function(e){var a=e.onStarClick,i=e.rating,n=e.label,t=Object(o.useMemo)((function(){return[null,null,null,null,null].map((function(e,a){return a<Math.floor(i)}))}),[i]),r=function(e,i){a(e,i)};return l.a.createElement("label",{className:"".concat(M.a.starpicker," c-action-primary")},n&&l.a.createElement("span",{className:"vtex-input__label db mb3 w-100 c-on-base "},n),l.a.createElement("span",{className:"t-heading-4 pointer"},t.map((function(e,a){return l.a.createElement(O.a,{key:a,filled:e,index:a,onClick:r})}))))},D={rating:3,title:"",text:"",location:"",reviewerName:"",shopperId:"",reviewSubmitted:!1,alreadySubmitted:!1,userAuthenticated:!1,validation:{hasTitle:!1,hasText:!1,hasName:!1,hasValidEmail:!1},showValidationErrors:!1,isSubmitting:!1},x=function(e,a){switch(a.type){case"SET_RATING":return Object.assign(Object.assign({},e),{rating:a.args.rating});case"SET_TITLE":return Object.assign(Object.assign({},e),{title:a.args.title,validation:Object.assign(Object.assign({},e.validation),{hasTitle:""!==a.args.title})});case"SET_TEXT":return Object.assign(Object.assign({},e),{text:a.args.text,validation:Object.assign(Object.assign({},e.validation),{hasText:""!==a.args.text})});case"SET_LOCATION":return Object.assign(Object.assign({},e),{location:a.args.location});case"SET_NAME":return Object.assign(Object.assign({},e),{reviewerName:a.args.name,validation:Object.assign(Object.assign({},e.validation),{hasName:""!==a.args.name})});case"SET_ID":return Object.assign(Object.assign({},e),{shopperId:a.args.id,validation:Object.assign(Object.assign({},e.validation),{hasValidEmail:a.args.id.includes("@")&&a.args.id.includes(".")})});case"SET_SUBMITTED":return Object.assign(Object.assign({},e),{reviewSubmitted:!0});case"SET_SUBMITTING":return Object.assign(Object.assign({},e),{isSubmitting:a.args.isSubmitting});case"SET_AUTHENTICATED":return Object.assign(Object.assign({},e),{userAuthenticated:!0});case"SET_ALREADY_SUBMITTED":return Object.assign(Object.assign({},e),{alreadySubmitted:!0});case"SHOW_VALIDATION":return Object.assign(Object.assign({},e),{showValidationErrors:!0});default:return e}},A=Object(u.defineMessages)({reviewTitleLabel:{id:"store/reviews.form.label.reviewTitle",defaultMessage:"The bottom line"},requiredField:{id:"store/reviews.form.requiredField",defaultMessage:"This field is required"},requiredFieldEmail:{id:"store/reviews.form.requiredFieldEmail",defaultMessage:"Please enter a valid email address"},ratingLabel:{id:"store/reviews.form.label.rating",defaultMessage:"Rate the product from 1 to 5 stars"},nameLabel:{id:"store/reviews.form.label.name",defaultMessage:"Your name"},locationLabel:{id:"store/reviews.form.label.location",defaultMessage:"Your location"},emailLabel:{id:"store/reviews.form.label.email",defaultMessage:"Email address"},reviewLabel:{id:"store/reviews.form.label.review",defaultMessage:"Write a review"}}),R=["formContainer","formSection","formBottomLine","formRating","formName","formLocation","formEmail","formReview","formSubmit","formInvalidMessage"];function V(e){var a,i=e.settings,n=Object(m.useApolloClient)(),d=Object(u.useIntl)(),v=f()(R),g=(null!==(a=c()())&&void 0!==a?a:{}).product,p=(null!=g?g:{}).productId,E=Object(o.useReducer)(x,D),S=Object(s.a)(E,2),N=S[0],I=S[1];function O(){return(O=Object(r.a)(t.a.mark((function e(){return t.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:I({type:"SET_SUBMITTING",args:{isSubmitting:!0}}),N.validation.hasValidEmail&&n.query({query:y.a,variables:{shopperId:N.shopperId,productId:p}}).then((function(e){e.data.hasShopperReviewed&&I({type:"SET_ALREADY_SUBMITTED"})})),N.validation.hasName&&N.validation.hasTitle&&N.validation.hasText&&N.validation.hasValidEmail?n.mutate({mutation:T.a,variables:{review:{productId:p,rating:N.rating,title:N.title,text:N.text,reviewerName:N.reviewerName}}}).then((function(){I({type:"SET_SUBMITTED"}),I({type:"SET_SUBMITTING",args:{isSubmitting:!1}})})):(I({type:"SHOW_VALIDATION"}),I({type:"SET_SUBMITTING",args:{isSubmitting:!1}}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(o.useEffect)((function(){p&&window.__RENDER_8_SESSION__.sessionPromise.then((function(e){var a,i,t,r,s,o,l,d=e.response;if(d&&d.namespaces){var c=d.namespaces;if(null===(i=null===(a=null==c?void 0:c.authentication)||void 0===a?void 0:a.storeUserId)||void 0===i?void 0:i.value){I({type:"SET_AUTHENTICATED",args:{authenticated:!0}});var m={email:null!==(s=null===(r=null===(t=c.profile)||void 0===t?void 0:t.email)||void 0===r?void 0:r.value)&&void 0!==s?s:null===(l=null===(o=c.authentication)||void 0===o?void 0:o.storeUserEmail)||void 0===l?void 0:l.value};"string"==typeof m.email&&(I({type:"SET_ID",args:{id:m.email}}),n.query({query:y.a,variables:{shopperId:m.email,productId:p}}).then((function(e){e.data.hasShopperReviewed&&I({type:"SET_ALREADY_SUBMITTED"})})))}}}))}),[n,p]),l.a.createElement("div",{className:"".concat(v.formContainer," bg-muted-5 pa5 mt2")},l.a.createElement(b.a,null,l.a.createElement("h3",null,l.a.createElement(u.FormattedMessage,{id:"store/reviews.form.title"})),N.reviewSubmitted?l.a.createElement("h5",null,l.a.createElement(u.FormattedMessage,{id:"store/reviews.form.reviewSubmitted"})):N.alreadySubmitted?l.a.createElement("div",{className:"c-danger t-small mt3 lh-title"},l.a.createElement(u.FormattedMessage,{id:"store/reviews.form.alreadySubmitted"})):l.a.createElement("form",null,l.a.createElement("div",{className:"".concat(v.formSection," ").concat(v.formBottomLine," mv3")},l.a.createElement(h.a,{label:d.formatMessage(A.reviewTitleLabel),size:"large",value:N.title,required:!0,onChange:function(e){return I({type:"SET_TITLE",args:{title:e.currentTarget.value}})},errorMessage:N.showValidationErrors&&!N.validation.hasTitle?d.formatMessage(A.requiredField):""})),l.a.createElement("div",{className:"".concat(v.formSection," ").concat(v.formRating," mv3")},l.a.createElement(j,{label:d.formatMessage(A.ratingLabel),rating:N.rating,onStarClick:function(e,a){I({type:"SET_RATING",args:{rating:a+1}})}})),l.a.createElement("div",{className:"".concat(v.formSection," ").concat(v.formName," mv3")},l.a.createElement(h.a,{label:d.formatMessage(A.nameLabel),size:"large",value:N.reviewerName,onChange:function(e){return I({type:"SET_NAME",args:{name:e.currentTarget.value}})},errorMessage:N.showValidationErrors&&!N.validation.hasName?d.formatMessage(A.requiredField):""})),(null==i?void 0:i.useLocation)&&l.a.createElement("div",{className:"".concat(v.formSection," ").concat(v.formLocation," mv3")},l.a.createElement(h.a,{label:d.formatMessage(A.locationLabel),size:"large",value:N.location,onChange:function(e){return I({type:"SET_LOCATION",args:{location:e.currentTarget.value}})}})),(null==i?void 0:i.allowAnonymousReviews)&&!N.userAuthenticated&&l.a.createElement("div",{className:"".concat(v.formSection," ").concat(v.formEmail," mv3")},l.a.createElement(h.a,{label:d.formatMessage(A.emailLabel),size:"large",value:N.shopperId,onChange:function(e){return I({type:"SET_ID",args:{id:e.currentTarget.value}})},errorMessage:N.showValidationErrors&&!N.validation.hasValidEmail?d.formatMessage(A.requiredFieldEmail):""})),l.a.createElement("div",{className:"".concat(v.formSection," ").concat(v.formReview," mv3")},l.a.createElement(w.a,{value:N.text,onChange:function(e){return I({type:"SET_TEXT",args:{text:e.currentTarget.value}})},label:d.formatMessage(A.reviewLabel),errorMessage:N.showValidationErrors&&!N.validation.hasText?d.formatMessage(A.requiredField):""})),l.a.createElement("div",{className:"".concat(v.formSection," ").concat(v.formSubmit," mv3")},l.a.createElement(o.Fragment,null,N.showValidationErrors&&(!N.validation.hasName||!N.validation.hasTitle||!N.validation.hasText||!N.validation.hasValidEmail)&&l.a.createElement("div",{className:"".concat(v.formInvalidMessage," c-danger t-small mt3 lh-title")},l.a.createElement(u.FormattedMessage,{id:"store/reviews.form.invalid"})),l.a.createElement(k.a,{variation:"primary",onClick:function(){return function(){return O.apply(this,arguments)}()},isLoading:N.isSubmitting},l.a.createElement(u.FormattedMessage,{id:"store/reviews.form.submit"})))))))}a.default=V},55:function(e,a){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"HasShopperReviewed"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"shopperId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"productId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[{kind:"Directive",name:{kind:"Name",value:"context"},arguments:[{kind:"Argument",name:{kind:"Name",value:"sender"},value:{kind:"StringValue",value:"vtex.reviews-and-ratings@2.12.8",block:!1}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasShopperReviewed"},arguments:[{kind:"Argument",name:{kind:"Name",value:"shopperId"},value:{kind:"Variable",name:{kind:"Name",value:"shopperId"}}},{kind:"Argument",name:{kind:"Name",value:"productId"},value:{kind:"Variable",name:{kind:"Name",value:"productId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"runtimeMeta"},arguments:[{kind:"Argument",name:{kind:"Name",value:"hash"},value:{kind:"StringValue",value:"e3e9f75cba702aacde57a9e0aa30d21708b334fd661195b23490135205fae22b",block:!1}}]}]}]}}],loc:{start:0,end:277}};i.loc.source={body:'query HasShopperReviewed($shopperId: String!, $productId: String!) @context(sender: "vtex.reviews-and-ratings@2.12.8") {\n  hasShopperReviewed(shopperId: $shopperId, productId: $productId) @runtimeMeta(hash: "e3e9f75cba702aacde57a9e0aa30d21708b334fd661195b23490135205fae22b")\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var n={};function t(e,a){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==a)return n}}i.definitions.forEach((function(e){if(e.name){var a=new Set;!function e(a,i){if("FragmentSpread"===a.kind)i.add(a.name.value);else if("VariableDefinition"===a.kind){var n=a.type;"NamedType"===n.kind&&i.add(n.name.value)}a.selectionSet&&a.selectionSet.selections.forEach((function(a){e(a,i)})),a.variableDefinitions&&a.variableDefinitions.forEach((function(a){e(a,i)})),a.definitions&&a.definitions.forEach((function(a){e(a,i)}))}(e,a),n[e.name.value]=a}})),e.exports=i,e.exports.HasShopperReviewed=function(e,a){var i={kind:e.kind,definitions:[t(e,a)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[a]||new Set,s=new Set,o=new Set;for(r.forEach((function(e){o.add(e)}));o.size>0;){var l=o;o=new Set,l.forEach((function(e){s.has(e)||(s.add(e),(n[e]||new Set).forEach((function(e){o.add(e)})))}))}return s.forEach((function(a){var n=t(e,a);n&&i.definitions.push(n)})),i}(i,"HasShopperReviewed")},69:function(e,a){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"NewReview"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"review"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ReviewInput"}}},directives:[]}],directives:[{kind:"Directive",name:{kind:"Name",value:"context"},arguments:[{kind:"Argument",name:{kind:"Name",value:"sender"},value:{kind:"StringValue",value:"vtex.reviews-and-ratings@2.12.8",block:!1}}]},{kind:"Directive",name:{kind:"Name",value:"runtimeMeta"},arguments:[{kind:"Argument",name:{kind:"Name",value:"hash"},value:{kind:"StringValue",value:"5ff20049978ca20d916e39b10f45c82dbd0d9cd47bf2ab59afc6b8018a6ada81",block:!1}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"newReview"},arguments:[{kind:"Argument",name:{kind:"Name",value:"review"},value:{kind:"Variable",name:{kind:"Name",value:"review"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"cacheId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"productId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"rating"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"text"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"reviewerName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"reviewDateTime"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sku"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:342}};i.loc.source={body:'mutation NewReview($review: ReviewInput!) @context(sender: "vtex.reviews-and-ratings@2.12.8") @runtimeMeta(hash: "5ff20049978ca20d916e39b10f45c82dbd0d9cd47bf2ab59afc6b8018a6ada81") {\n  newReview(review: $review) {\n    id\n    cacheId\n    productId\n    rating\n    title\n    text\n    reviewerName\n    reviewDateTime\n    sku\n    __typename\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var n={};function t(e,a){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==a)return n}}i.definitions.forEach((function(e){if(e.name){var a=new Set;!function e(a,i){if("FragmentSpread"===a.kind)i.add(a.name.value);else if("VariableDefinition"===a.kind){var n=a.type;"NamedType"===n.kind&&i.add(n.name.value)}a.selectionSet&&a.selectionSet.selections.forEach((function(a){e(a,i)})),a.variableDefinitions&&a.variableDefinitions.forEach((function(a){e(a,i)})),a.definitions&&a.definitions.forEach((function(a){e(a,i)}))}(e,a),n[e.name.value]=a}})),e.exports=i,e.exports.NewReview=function(e,a){var i={kind:e.kind,definitions:[t(e,a)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[a]||new Set,s=new Set,o=new Set;for(r.forEach((function(e){o.add(e)}));o.size>0;){var l=o;o=new Set,l.forEach((function(e){s.has(e)||(s.add(e),(n[e]||new Set).forEach((function(e){o.add(e)})))}))}return s.forEach((function(a){var n=t(e,a);n&&i.definitions.push(n)})),i}(i,"NewReview")}}]);