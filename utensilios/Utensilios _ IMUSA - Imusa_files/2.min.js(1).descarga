(window.webpackJsonpvtex_reviews_and_ratings_3_13_0=window.webpackJsonpvtex_reviews_and_ratings_3_13_0||[]).push([[2],{24:function(e,a,i){"use strict";i.d(a,"a",(function(){return n}));var n={on:function(e,a){document.addEventListener(e,(function(e){return a(e.detail)}))},dispatch:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;document.dispatchEvent(new CustomEvent(e,{detail:a}))},remove:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;document.removeEventListener(e,a)}}},61:function(e,a,i){"use strict";i.r(a),i.d(a,"ReviewForm",(function(){return V}));var n=i(25),t=i.n(n),r=i(40),s=i(2),l=i(0),o=i.n(l),d=i(12),c=i.n(d),u=i(4),m=i(1),v=i(9),f=i.n(v),g=i(59),p=i.n(g),b=i(26),w=i.n(b),E=i(7),h=i.n(E),k=i(60),S=i.n(k),N=i(85),T=i.n(N),y=i(65),I=i.n(y),O=i(20),_=i(3),M=i.n(_),j=function(e){var a=e.onStarClick,i=e.rating,n=e.label,t=Object(l.useMemo)((function(){return[null,null,null,null,null].map((function(e,a){return a<Math.floor(i)}))}),[i]),r=function(e,i){a(e,i)};return o.a.createElement("label",{className:"".concat(M.a.starpicker," c-action-primary")},n&&o.a.createElement("span",{className:"vtex-input__label db mb3 w-100 c-on-base "},n),o.a.createElement("span",{className:"t-heading-4 pointer"},t.map((function(e,a){return o.a.createElement(O.a,{key:a,filled:e,index:a,onClick:r})}))))},x=i(24);function A(e){window.dataLayer.push(e)}window.dataLayer=(null===window||void 0===window?void 0:window.dataLayer)||[];var D=function(e,a){switch(a.type){case"SET_RATING":return Object.assign(Object.assign({},e),{rating:a.args.rating});case"SET_TITLE":return Object.assign(Object.assign({},e),{title:a.args.title,validation:Object.assign(Object.assign({},e.validation),{hasTitle:""!==a.args.title})});case"SET_TEXT":return Object.assign(Object.assign({},e),{text:a.args.text,validation:Object.assign(Object.assign({},e.validation),{hasText:""!==a.args.text})});case"SET_LOCATION":return Object.assign(Object.assign({},e),{location:a.args.location});case"SET_LOCALE":return Object.assign(Object.assign({},e),{locale:a.args.locale});case"SET_NAME":return Object.assign(Object.assign({},e),{reviewerName:a.args.name,validation:Object.assign(Object.assign({},e.validation),{hasName:""!==a.args.name})});case"SET_ID":return Object.assign(Object.assign({},e),{shopperId:a.args.id,validation:Object.assign(Object.assign({},e.validation),{hasValidEmail:a.args.id.includes("@")&&a.args.id.includes(".")})});case"SET_SUBMITTED":return Object.assign(Object.assign({},e),{reviewSubmitted:!0});case"SET_SUBMITTING":return Object.assign(Object.assign({},e),{isSubmitting:a.args.isSubmitting});case"SET_AUTHENTICATED":return Object.assign(Object.assign({},e),{userAuthenticated:!0});case"SET_ALREADY_SUBMITTED":return Object.assign(Object.assign({},e),{alreadySubmitted:a.args.alreadySubmitted});case"SHOW_VALIDATION":return Object.assign(Object.assign({},e),{showValidationErrors:!0});default:return e}},L=Object(m.defineMessages)({reviewTitleLabel:{id:"store/reviews.form.label.reviewTitle",defaultMessage:"The bottom line"},requiredField:{id:"store/reviews.form.requiredField",defaultMessage:"This field is required"},requiredFieldEmail:{id:"store/reviews.form.requiredFieldEmail",defaultMessage:"Please enter a valid email address"},ratingLabel:{id:"store/reviews.form.label.rating",defaultMessage:"Rate the product from 1 to 5 stars"},nameLabel:{id:"store/reviews.form.label.name",defaultMessage:"Your name"},locationLabel:{id:"store/reviews.form.label.location",defaultMessage:"Your location"},emailLabel:{id:"store/reviews.form.label.email",defaultMessage:"Email address"},reviewLabel:{id:"store/reviews.form.label.review",defaultMessage:"Write a review"}}),R=["formContainer","formSection","formBottomLine","formRating","formName","formLocation","formEmail","formReview","formSubmit","formInvalidMessage"];function V(e){var a,i=e.settings,n=e.refetchReviews,d=Object(u.useApolloClient)(),v=Object(m.useIntl)(),g=f()(R),b=(null!==(a=c()())&&void 0!==a?a:{}).product,E=(null!=b?b:{}).productId,k=Object(l.useReducer)(D,{rating:5,title:"",text:"",location:"",locale:null,reviewerName:"",shopperId:"",reviewSubmitted:!1,alreadySubmitted:!1,userAuthenticated:!1,validation:{hasTitle:!1,hasText:!1,hasName:!1,hasValidEmail:!1},showValidationErrors:!1,isSubmitting:!1}),N=Object(s.a)(k,2),y=N[0],O=N[1],_=function(){return x.a.dispatch("reviewSaved")};function M(){return(M=Object(r.a)(t.a.mark((function e(){var a;return t.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O({type:"SET_SUBMITTING",args:{isSubmitting:!0}}),y.validation.hasValidEmail&&d.query({query:I.a,variables:{shopperId:y.shopperId,productId:E}}).then((function(e){e.data&&O({type:"SET_ALREADY_SUBMITTED",args:{alreadySubmitted:e.data.hasShopperReviewed}})})),y.validation.hasName&&y.validation.hasTitle&&y.validation.hasText&&y.validation.hasValidEmail?d.mutate({mutation:T.a,variables:{review:{productId:E,rating:y.rating,title:y.title,text:y.text,reviewerName:y.reviewerName,locale:null!==(a=y.locale)&&void 0!==a?a:null,approved:!(null==i?void 0:i.requireApproval)}}}).then((function(e){e.data.newReview.id&&(A({event:"reviewSubmitted",productId:E,rating:y.rating}),setTimeout((function(){!(null==i?void 0:i.requireApproval)&&(null==i?void 0:i.allowAnonymousReviews)&&(n(),_()),O({type:"SET_SUBMITTED"}),O({type:"SET_SUBMITTING",args:{isSubmitting:!1}})}),2e3))})):(O({type:"SHOW_VALIDATION"}),O({type:"SET_SUBMITTING",args:{isSubmitting:!1}}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(l.useEffect)((function(){(null==i?void 0:i.defaultStarsRating)&&O({type:"SET_RATING",args:{rating:i.defaultStarsRating}})}),[i]),Object(l.useEffect)((function(){E&&window.__RENDER_8_SESSION__.sessionPromise.then((function(e){var a,i,n,t,r,s,l,o=e.response;if(o&&o.namespaces){var c=o.namespaces;if(null===(i=null===(a=null==c?void 0:c.authentication)||void 0===a?void 0:a.storeUserId)||void 0===i?void 0:i.value){O({type:"SET_AUTHENTICATED",args:{authenticated:!0}}),O({type:"SET_LOCALE",args:{locale:v.locale}});var u={email:null!==(r=null===(t=null===(n=c.profile)||void 0===n?void 0:n.email)||void 0===t?void 0:t.value)&&void 0!==r?r:null===(l=null===(s=c.authentication)||void 0===s?void 0:s.storeUserEmail)||void 0===l?void 0:l.value};"string"==typeof u.email&&(O({type:"SET_ID",args:{id:u.email}}),d.query({query:I.a,variables:{shopperId:u.email,productId:E}}).then((function(e){e.data&&O({type:"SET_ALREADY_SUBMITTED",args:{alreadySubmitted:e.data.hasShopperReviewed}})})))}}}))}),[d,v,E]),o.a.createElement("div",{className:"".concat(g.formContainer," bg-muted-5 pa5 mt2")},o.a.createElement(p.a,null,o.a.createElement("h3",null,o.a.createElement(m.FormattedMessage,{id:"store/reviews.form.title"})),y.reviewSubmitted?o.a.createElement("h5",null,o.a.createElement(m.FormattedMessage,{id:"store/reviews.form.reviewSubmitted"})):y.alreadySubmitted?o.a.createElement("div",{className:"c-danger t-small mt3 lh-title"},o.a.createElement(m.FormattedMessage,{id:"store/reviews.form.alreadySubmitted"})):o.a.createElement("form",null,o.a.createElement("div",{className:"".concat(g.formSection," ").concat(g.formBottomLine," mv3")},o.a.createElement(w.a,{label:v.formatMessage(L.reviewTitleLabel),size:"large",value:y.title,required:!0,onChange:function(e){return O({type:"SET_TITLE",args:{title:e.currentTarget.value}})},errorMessage:y.showValidationErrors&&!y.validation.hasTitle?v.formatMessage(L.requiredField):""})),o.a.createElement("div",{className:"".concat(g.formSection," ").concat(g.formRating," mv3")},o.a.createElement(j,{label:v.formatMessage(L.ratingLabel),rating:y.rating,onStarClick:function(e,a){O({type:"SET_RATING",args:{rating:a+1}})}})),o.a.createElement("div",{className:"".concat(g.formSection," ").concat(g.formName," mv3")},o.a.createElement(w.a,{label:v.formatMessage(L.nameLabel),size:"large",value:y.reviewerName,onChange:function(e){return O({type:"SET_NAME",args:{name:e.currentTarget.value}})},errorMessage:y.showValidationErrors&&!y.validation.hasName?v.formatMessage(L.requiredField):""})),(null==i?void 0:i.useLocation)&&o.a.createElement("div",{className:"".concat(g.formSection," ").concat(g.formLocation," mv3")},o.a.createElement(w.a,{label:v.formatMessage(L.locationLabel),size:"large",value:y.location,onChange:function(e){return O({type:"SET_LOCATION",args:{location:e.currentTarget.value}})}})),(null==i?void 0:i.allowAnonymousReviews)&&!y.userAuthenticated&&o.a.createElement("div",{className:"".concat(g.formSection," ").concat(g.formEmail," mv3")},o.a.createElement(w.a,{label:v.formatMessage(L.emailLabel),size:"large",value:y.shopperId,onChange:function(e){return O({type:"SET_ID",args:{id:e.currentTarget.value}})},errorMessage:y.showValidationErrors&&!y.validation.hasValidEmail?v.formatMessage(L.requiredFieldEmail):""})),o.a.createElement("div",{className:"".concat(g.formSection," ").concat(g.formReview," mv3")},o.a.createElement(S.a,{value:y.text,onChange:function(e){return O({type:"SET_TEXT",args:{text:e.currentTarget.value}})},label:v.formatMessage(L.reviewLabel),errorMessage:y.showValidationErrors&&!y.validation.hasText?v.formatMessage(L.requiredField):""})),o.a.createElement("div",{className:"".concat(g.formSection," ").concat(g.formSubmit," mv3")},o.a.createElement(l.Fragment,null,y.showValidationErrors&&(!y.validation.hasName||!y.validation.hasTitle||!y.validation.hasText||!y.validation.hasValidEmail)&&o.a.createElement("div",{className:"".concat(g.formInvalidMessage," c-danger t-small mt3 lh-title")},o.a.createElement(m.FormattedMessage,{id:"store/reviews.form.invalid"})),o.a.createElement(h.a,{variation:"primary",onClick:function(){return function(){return M.apply(this,arguments)}()},isLoading:y.isSubmitting},o.a.createElement(m.FormattedMessage,{id:"store/reviews.form.submit"})))))))}a.default=V},65:function(e,a){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"HasShopperReviewed"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"shopperId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"productId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[{kind:"Directive",name:{kind:"Name",value:"context"},arguments:[{kind:"Argument",name:{kind:"Name",value:"sender"},value:{kind:"StringValue",value:"vtex.reviews-and-ratings@3.13.0",block:!1}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasShopperReviewed"},arguments:[{kind:"Argument",name:{kind:"Name",value:"shopperId"},value:{kind:"Variable",name:{kind:"Name",value:"shopperId"}}},{kind:"Argument",name:{kind:"Name",value:"productId"},value:{kind:"Variable",name:{kind:"Name",value:"productId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"context"},arguments:[{kind:"Argument",name:{kind:"Name",value:"provider"},value:{kind:"StringValue",value:"vtex.reviews-and-ratings",block:!1}}]},{kind:"Directive",name:{kind:"Name",value:"runtimeMeta"},arguments:[{kind:"Argument",name:{kind:"Name",value:"hash"},value:{kind:"StringValue",value:"80a72f03de896c82ae8cb59fc63f99e3d250659e9044040194886f02372e8eee",block:!1}}]}]}]}}],loc:{start:0,end:324}};i.loc.source={body:'query HasShopperReviewed($shopperId: String!, $productId: String!) @context(sender: "vtex.reviews-and-ratings@3.13.0") {\n  hasShopperReviewed(shopperId: $shopperId, productId: $productId) @context(provider: "vtex.reviews-and-ratings") @runtimeMeta(hash: "80a72f03de896c82ae8cb59fc63f99e3d250659e9044040194886f02372e8eee")\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var n={};function t(e,a){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==a)return n}}i.definitions.forEach((function(e){if(e.name){var a=new Set;!function e(a,i){if("FragmentSpread"===a.kind)i.add(a.name.value);else if("VariableDefinition"===a.kind){var n=a.type;"NamedType"===n.kind&&i.add(n.name.value)}a.selectionSet&&a.selectionSet.selections.forEach((function(a){e(a,i)})),a.variableDefinitions&&a.variableDefinitions.forEach((function(a){e(a,i)})),a.definitions&&a.definitions.forEach((function(a){e(a,i)}))}(e,a),n[e.name.value]=a}})),e.exports=i,e.exports.HasShopperReviewed=function(e,a){var i={kind:e.kind,definitions:[t(e,a)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[a]||new Set,s=new Set,l=new Set;for(r.forEach((function(e){l.add(e)}));l.size>0;){var o=l;l=new Set,o.forEach((function(e){s.has(e)||(s.add(e),(n[e]||new Set).forEach((function(e){l.add(e)})))}))}return s.forEach((function(a){var n=t(e,a);n&&i.definitions.push(n)})),i}(i,"HasShopperReviewed")},85:function(e,a){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"NewReview"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"review"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ReviewInput"}}},directives:[]}],directives:[{kind:"Directive",name:{kind:"Name",value:"context"},arguments:[{kind:"Argument",name:{kind:"Name",value:"sender"},value:{kind:"StringValue",value:"vtex.reviews-and-ratings@3.13.0",block:!1}}]},{kind:"Directive",name:{kind:"Name",value:"runtimeMeta"},arguments:[{kind:"Argument",name:{kind:"Name",value:"hash"},value:{kind:"StringValue",value:"1c4929dd35b425404f7cf9b11fa41094ab2f2018283420f2d17ddf824a6afcd3",block:!1}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"newReview"},arguments:[{kind:"Argument",name:{kind:"Name",value:"review"},value:{kind:"Variable",name:{kind:"Name",value:"review"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"context"},arguments:[{kind:"Argument",name:{kind:"Name",value:"provider"},value:{kind:"StringValue",value:"vtex.reviews-and-ratings",block:!1}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"productId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"rating"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"text"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"reviewerName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"locale"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"reviewDateTime"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sku"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:388}};i.loc.source={body:'mutation NewReview($review: ReviewInput!) @context(sender: "vtex.reviews-and-ratings@3.13.0") @runtimeMeta(hash: "1c4929dd35b425404f7cf9b11fa41094ab2f2018283420f2d17ddf824a6afcd3") {\n  newReview(review: $review) @context(provider: "vtex.reviews-and-ratings") {\n    id\n    productId\n    rating\n    title\n    text\n    reviewerName\n    locale\n    reviewDateTime\n    sku\n    __typename\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var n={};function t(e,a){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==a)return n}}i.definitions.forEach((function(e){if(e.name){var a=new Set;!function e(a,i){if("FragmentSpread"===a.kind)i.add(a.name.value);else if("VariableDefinition"===a.kind){var n=a.type;"NamedType"===n.kind&&i.add(n.name.value)}a.selectionSet&&a.selectionSet.selections.forEach((function(a){e(a,i)})),a.variableDefinitions&&a.variableDefinitions.forEach((function(a){e(a,i)})),a.definitions&&a.definitions.forEach((function(a){e(a,i)}))}(e,a),n[e.name.value]=a}})),e.exports=i,e.exports.NewReview=function(e,a){var i={kind:e.kind,definitions:[t(e,a)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[a]||new Set,s=new Set,l=new Set;for(r.forEach((function(e){l.add(e)}));l.size>0;){var o=l;l=new Set,o.forEach((function(e){s.has(e)||(s.add(e),(n[e]||new Set).forEach((function(e){l.add(e)})))}))}return s.forEach((function(a){var n=t(e,a);n&&i.definitions.push(n)})),i}(i,"NewReview")}}]);